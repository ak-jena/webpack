{"version":3,"file":"ActionButton.js","sourceRoot":"","sources":["ActionButton.ts"],"names":[],"mappings":"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","sourcesContent":["/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n    CSSResultArray,\n    html,\n    property,\n    PropertyValues,\n    TemplateResult,\n    SizedMixin,\n    ElementSize,\n} from '@spectrum-web-components/base';\nimport { ButtonBase } from '@spectrum-web-components/button';\nimport buttonStyles from './action-button.css.js';\nimport cornerTriangleStyles from '@spectrum-web-components/icon/src/spectrum-icon-corner-triangle.css.js';\nimport '@spectrum-web-components/icons-ui/icons/sp-icon-corner-triangle300.js';\n\nconst holdAffordanceClass = {\n    s: 'spectrum-UIIcon-CornerTriangle75',\n    m: 'spectrum-UIIcon-CornerTriangle100',\n    l: 'spectrum-UIIcon-CornerTriangle200',\n    xl: 'spectrum-UIIcon-CornerTriangle300',\n};\n\nconst LONGPRESS_DURATION = 300;\nlet LONGPRESS_TIMEOUT: ReturnType<typeof setTimeout>;\n\nexport type LongpressEvent = {\n    source: 'pointer' | 'keyboard';\n};\n\ntype ActionButtonSize = Exclude<ElementSize, 'xxl'>;\n\n/**\n * @element sp-card\n *\n * @fires change - Announces a change in the `selected` property of an action button\n * @fires longpress - Synthesizes a \"longpress\" interaction that signifies a\n * `pointerdown` event that is >=300ms or a keyboard event wher code is `Space` or code is `ArrowDown`\n * while `altKey===true`.\n */\nexport class ActionButton extends SizedMixin(ButtonBase) {\n    public static get styles(): CSSResultArray {\n        return [buttonStyles, cornerTriangleStyles];\n    }\n\n    @property({ type: Boolean, reflect: true })\n    public emphasized = false;\n\n    @property({ type: Boolean, reflect: true, attribute: 'hold-affordance' })\n    public holdAffordance = false;\n\n    @property({ type: Boolean, reflect: true })\n    public quiet = false;\n\n    @property({ type: Boolean, reflect: true })\n    public selected = false;\n\n    @property({ type: Boolean, reflect: true })\n    public toggles = false;\n\n    @property({ type: String })\n    public get value(): string {\n        return this._value || this.itemText;\n    }\n    public set value(value: string) {\n        if (value === this._value) {\n            return;\n        }\n        this._value = value || '';\n        if (this._value) {\n            this.setAttribute('value', this._value);\n        } else {\n            this.removeAttribute('value');\n        }\n    }\n    private _value = '';\n\n    /**\n     * @private\n     */\n    public get itemText(): string {\n        return (this.textContent || /* c8 ignore next */ '').trim();\n    }\n\n    constructor() {\n        super();\n        this.addEventListener('click', this.onClick);\n        this.addEventListener('pointerdown', this.onPointerdown);\n    }\n\n    private onClick = (): void => {\n        if (!this.toggles) {\n            return;\n        }\n        this.selected = !this.selected;\n        const applyDefault = this.dispatchEvent(\n            new Event('change', {\n                cancelable: true,\n            })\n        );\n        if (!applyDefault) {\n            this.selected = !this.selected;\n        }\n    };\n\n    private onPointerdown(): void {\n        this.addEventListener('pointerup', this.onPointerup);\n        this.addEventListener('pointercancel', this.onPointerup);\n        LONGPRESS_TIMEOUT = setTimeout(() => {\n            this.dispatchEvent(\n                new CustomEvent<LongpressEvent>('longpress', {\n                    bubbles: true,\n                    composed: true,\n                    detail: {\n                        source: 'pointer',\n                    },\n                })\n            );\n        }, LONGPRESS_DURATION);\n    }\n\n    private onPointerup(): void {\n        clearTimeout(LONGPRESS_TIMEOUT);\n        this.removeEventListener('pointerup', this.onPointerup);\n        this.removeEventListener('pointercancel', this.onPointerup);\n    }\n\n    /**\n     * @private\n     */\n    protected handleKeydown(event: KeyboardEvent): void {\n        if (!this.holdAffordance) {\n            return super.handleKeydown(event);\n        }\n        const { code, altKey } = event;\n        if (code === 'Space' || (altKey && code === 'ArrowDown')) {\n            event.preventDefault();\n            if (code === 'ArrowDown') {\n                event.stopPropagation();\n                event.stopImmediatePropagation();\n            }\n            this.addEventListener('keyup', this.handleKeyup);\n            this.active = true;\n        }\n    }\n\n    protected handleKeyup(event: KeyboardEvent): void {\n        if (!this.holdAffordance) {\n            return super.handleKeyup(event);\n        }\n        const { code, altKey } = event;\n        if (code === 'Space' || (altKey && code === 'ArrowDown')) {\n            event.stopPropagation();\n            this.dispatchEvent(\n                new CustomEvent<LongpressEvent>('longpress', {\n                    bubbles: true,\n                    composed: true,\n                    detail: {\n                        source: 'keyboard',\n                    },\n                })\n            );\n            this.active = false;\n        }\n    }\n\n    protected get buttonContent(): TemplateResult[] {\n        const buttonContent = super.buttonContent;\n        if (this.holdAffordance) {\n            buttonContent.unshift(html`\n                <sp-icon-corner-triangle300\n                    id=\"hold-affordance\"\n                    class=\"${holdAffordanceClass[\n                        this.size as ActionButtonSize\n                    ]}\"\n                ></sp-icon-corner-triangle300>\n            `);\n        }\n        return buttonContent;\n    }\n\n    protected updated(changes: PropertyValues): void {\n        super.updated(changes);\n        if (this.toggles && changes.has('selected')) {\n            this.focusElement.setAttribute(\n                'aria-pressed',\n                this.selected ? 'true' : 'false'\n            );\n        }\n    }\n}\n\ndeclare global {\n    interface GlobalEventHandlersEventMap {\n        longpress: CustomEvent<LongpressEvent>;\n    }\n}\n"]}