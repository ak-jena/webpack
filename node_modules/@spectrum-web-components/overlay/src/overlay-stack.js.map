{"version":3,"file":"overlay-stack.js","sourceRoot":"","sources":["overlay-stack.ts"],"names":[],"mappings":"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","sourcesContent":["/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { ActiveOverlay } from './ActiveOverlay.js';\nimport { OverlayOpenDetail, OverlayOpenCloseDetail } from './overlay-types';\nimport { OverlayTimer } from './overlay-timer.js';\nimport '../active-overlay.js';\n\nfunction isLeftClick(event: MouseEvent): boolean {\n    return event.button === 0;\n}\n\nfunction hasModifier(event: MouseEvent): boolean {\n    return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\n}\n\ninterface ManagedOverlayContent {\n    open: boolean;\n    overlayWillOpenCallback?: (args: { trigger: HTMLElement }) => void;\n    overlayOpenCallback?: (args: { trigger: HTMLElement }) => void;\n    overlayOpenCancelledCallback?: (args: { trigger: HTMLElement }) => void;\n    overlayCloseCallback?: (args: { trigger: HTMLElement }) => void;\n}\n\nexport class OverlayStack {\n    public overlays: ActiveOverlay[] = [];\n\n    private preventMouseRootClose = false;\n    private root: HTMLElement = document.body;\n    private handlingResize = false;\n    private overlayTimer = new OverlayTimer();\n\n    public constructor() {\n        this.addEventListeners();\n    }\n\n    private canTabTrap = true;\n    private trappingInited = false;\n    private tabTrapper!: HTMLElement;\n    private overlayHolder!: HTMLElement;\n\n    private initTabTrapping(): void {\n        /* c8 ignore next 4 */\n        if (this.document.body.shadowRoot) {\n            this.canTabTrap = false;\n            return;\n        }\n        this.document.body.attachShadow({ mode: 'open' });\n        /* c8 ignore next 3 */\n        if (!this.document.body.shadowRoot) {\n            return;\n        }\n        const root = this.document.body.shadowRoot as ShadowRoot;\n        root.innerHTML = `\n            <div id=\"actual\"><slot></slot></div>\n            <style>\n            #actual {\n                position: relative;\n                height: calc(100% - var(--swc-body-margins-block, 0px));\n                z-index: 0;\n                min-height: calc(100vh - var(--swc-body-margins-block, 0px));\n            }\n            #holder {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                flex-flow: column;\n                height: 100%;\n                width: 100%;\n                top: 0;\n                left: 0;\n                position: fixed;\n            }\n            #holder[hidden] {\n                display: none !important;\n            }\n            #actual[tabindex=\"-1\"] {\n                pointer-events: none;  /* just in case? */\n            }\n            </style>\n            <div id=\"holder\" hidden><slot name=\"open\"></slot></div>\n        `;\n        this.tabTrapper = root.querySelector('#actual') as HTMLElement;\n        this.overlayHolder = root.querySelector('#holder') as HTMLElement;\n        this.tabTrapper.attachShadow({ mode: 'open' });\n        if (this.tabTrapper.shadowRoot) {\n            this.tabTrapper.shadowRoot.innerHTML = '<slot></slot>';\n        }\n    }\n\n    private startTabTrapping(): void {\n        if (!this.trappingInited) {\n            this.initTabTrapping();\n            this.trappingInited = true;\n        }\n        /* c8 ignore next 3 */\n        if (!this.canTabTrap) {\n            return;\n        }\n        this.tabTrapper.tabIndex = -1;\n        this.tabTrapper.setAttribute('aria-hidden', 'true');\n        this.overlayHolder.hidden = false;\n        requestAnimationFrame(() => {\n            const bodyStyles = getComputedStyle(document.body);\n            this.tabTrapper.style.setProperty(\n                '--swc-body-margins-inline',\n                `calc(${bodyStyles.marginLeft} + ${bodyStyles.marginRight})`\n            );\n            this.tabTrapper.style.setProperty(\n                '--swc-body-margins-block',\n                `calc(${bodyStyles.marginTop} + ${bodyStyles.marginBottom})`\n            );\n        });\n    }\n\n    private stopTabTrapping(): void {\n        /* c8 ignore next 3 */\n        if (!this.canTabTrap || !this.trappingInited) {\n            return;\n        }\n        this.tabTrapper.removeAttribute('tabindex');\n        this.tabTrapper.removeAttribute('aria-hidden');\n        this.overlayHolder.hidden = true;\n    }\n\n    private get document(): Document {\n        return this.root.ownerDocument /* c8 ignore next */ || document;\n    }\n\n    private get topOverlay(): ActiveOverlay | undefined {\n        return this.overlays.slice(-1)[0];\n    }\n\n    private findOverlayForContent(\n        overlayContent: HTMLElement\n    ): ActiveOverlay | undefined {\n        for (const item of this.overlays) {\n            if (overlayContent === item.overlayContent) {\n                return item;\n            }\n        }\n        return undefined;\n    }\n\n    private addEventListeners(): void {\n        this.document.addEventListener('click', this.handleMouseCapture, true);\n        this.document.addEventListener('click', this.handleMouse);\n        this.document.addEventListener('keyup', this.handleKeyUp);\n        window.addEventListener('resize', this.handleResize);\n    }\n\n    private isClickOverlayActiveForTrigger(trigger: HTMLElement): boolean {\n        return this.overlays.some(\n            (item) => trigger === item.trigger && item.interaction === 'click'\n        );\n    }\n\n    public async openOverlay(details: OverlayOpenDetail): Promise<boolean> {\n        if (this.findOverlayForContent(details.content)) {\n            return false;\n        }\n        if (details.notImmediatelyClosable) {\n            this._doesNotCloseOnFirstClick = true;\n        }\n        if (details.interaction === 'modal') {\n            this.startTabTrapping();\n        }\n\n        const contentWithLifecycle = (details.content as unknown) as ManagedOverlayContent;\n        if (contentWithLifecycle.overlayWillOpenCallback) {\n            const { trigger } = details;\n            contentWithLifecycle.overlayWillOpenCallback({ trigger });\n        }\n\n        if (details.delayed) {\n            const cancelledPromise = this.overlayTimer.openTimer(\n                details.content\n            );\n            const promises = [cancelledPromise];\n            if (details.abortPromise) {\n                promises.push(details.abortPromise);\n            }\n            const cancelled = await Promise.race(promises);\n            if (cancelled) {\n                if (contentWithLifecycle.overlayOpenCancelledCallback) {\n                    const { trigger } = details;\n                    contentWithLifecycle.overlayOpenCancelledCallback({\n                        trigger,\n                    });\n                }\n                return cancelled;\n            }\n        }\n\n        if (details.interaction === 'click') {\n            this.closeAllHoverOverlays();\n        } else if (\n            details.interaction === 'hover' &&\n            this.isClickOverlayActiveForTrigger(details.trigger)\n        ) {\n            // Don't show a hover popover if the click popover is already active\n            return true;\n        }\n\n        const activeOverlay = ActiveOverlay.create(details);\n\n        if (this.overlays.length) {\n            const topOverlay = this.overlays[this.overlays.length - 1];\n            topOverlay.obscure(activeOverlay.interaction);\n        }\n\n        document.body.appendChild(activeOverlay);\n\n        /**\n         * The following work to make the new overlay the \"top\" of the stack\n         * has to happen AFTER the current call stack completes in case there\n         * is work there in to remove the previous \"top\" overlay.\n         */\n        return new Promise((res) => requestAnimationFrame(res)).then(\n            async () => {\n                this.overlays.push(activeOverlay);\n                await activeOverlay.updateComplete;\n                this.addOverlayEventListeners(activeOverlay);\n                if (typeof contentWithLifecycle.open !== 'undefined') {\n                    contentWithLifecycle.open = true;\n                }\n                if (contentWithLifecycle.overlayOpenCallback) {\n                    const { trigger } = activeOverlay;\n                    contentWithLifecycle.overlayOpenCallback({ trigger });\n                }\n                if (details.receivesFocus === 'auto') {\n                    activeOverlay.focus();\n                }\n                details.trigger.dispatchEvent(\n                    new CustomEvent<OverlayOpenCloseDetail>('sp-opened', {\n                        bubbles: true,\n                        composed: true,\n                        cancelable: true,\n                        detail: {\n                            interaction: details.interaction,\n                        },\n                    })\n                );\n                return false;\n            }\n        );\n    }\n\n    public addOverlayEventListeners(activeOverlay: ActiveOverlay): void {\n        activeOverlay.addEventListener('close', () => {\n            this.hideAndCloseOverlay(activeOverlay);\n        });\n        switch (activeOverlay.interaction) {\n            case 'replace':\n                this.addReplaceOverlayEventListeners(activeOverlay);\n                break;\n            case 'inline':\n                this.addInlineOverlayEventListeners(activeOverlay);\n                break;\n        }\n    }\n\n    public addReplaceOverlayEventListeners(activeOverlay: ActiveOverlay): void {\n        activeOverlay.addEventListener('keydown', (event: KeyboardEvent) => {\n            const { code } = event;\n            /* c8 ignore next */\n            if (code !== 'Tab') return;\n\n            event.stopPropagation();\n            this.closeOverlay(activeOverlay.overlayContent);\n            activeOverlay.tabbingAway = true;\n            activeOverlay.trigger.focus();\n            activeOverlay.trigger.dispatchEvent(\n                new KeyboardEvent('keydown', event)\n            );\n        });\n    }\n\n    public addInlineOverlayEventListeners(activeOverlay: ActiveOverlay): void {\n        activeOverlay.trigger.addEventListener(\n            'keydown',\n            activeOverlay.handleInlineTriggerKeydown\n        );\n        activeOverlay.addEventListener('keydown', (event: KeyboardEvent) => {\n            const { code, shiftKey } = event;\n            /* c8 ignore next */\n            if (code !== 'Tab') return;\n\n            activeOverlay.tabbingAway = true;\n            if (shiftKey) {\n                const returnFocusElement = document.createElement('span');\n                returnFocusElement.tabIndex = -1;\n                if (activeOverlay.trigger.hasAttribute('slot')) {\n                    returnFocusElement.slot = activeOverlay.trigger.slot;\n                }\n                activeOverlay.trigger.insertAdjacentElement(\n                    'afterend',\n                    returnFocusElement\n                );\n                returnFocusElement.focus();\n                returnFocusElement.remove();\n                return;\n            }\n\n            event.stopPropagation();\n            this.closeOverlay(activeOverlay.overlayContent);\n            activeOverlay.trigger.focus();\n        });\n    }\n\n    public closeOverlay(content: HTMLElement): void {\n        this.overlayTimer.close(content);\n        requestAnimationFrame(() => {\n            const overlay = this.findOverlayForContent(content);\n            this.hideAndCloseOverlay(overlay);\n        });\n    }\n\n    private handleMouseCapture = (event: MouseEvent): void => {\n        const topOverlay = this.topOverlay;\n        if (\n            !event.target ||\n            !topOverlay ||\n            !topOverlay.overlayContent ||\n            hasModifier(event) ||\n            !isLeftClick(event)\n        ) {\n            this.preventMouseRootClose = true;\n            return;\n        }\n\n        if (event.target instanceof Node) {\n            const path = event.composedPath();\n            if (path.indexOf(topOverlay.overlayContent) >= 0) {\n                this.preventMouseRootClose = true;\n                return;\n            }\n            this.preventMouseRootClose = false;\n        }\n    };\n\n    private closeAllHoverOverlays(): void {\n        for (const overlay of this.overlays) {\n            if (overlay.interaction === 'hover') {\n                this.hideAndCloseOverlay(overlay, false);\n            }\n        }\n    }\n\n    private async hideAndCloseOverlay(\n        overlay?: ActiveOverlay,\n        animated?: boolean\n    ): Promise<void> {\n        if (overlay) {\n            await overlay.hide(animated);\n            const contentWithLifecycle = (overlay.overlayContent as unknown) as ManagedOverlayContent;\n            if (typeof contentWithLifecycle.open !== 'undefined') {\n                contentWithLifecycle.open = false;\n            }\n            if (contentWithLifecycle.overlayCloseCallback) {\n                const { trigger } = overlay;\n                contentWithLifecycle.overlayCloseCallback({ trigger });\n            }\n            if (overlay.state != 'dispose') return;\n\n            const index = this.overlays.indexOf(overlay);\n            if (index >= 0) {\n                this.overlays.splice(index, 1);\n            }\n            if (this.overlays.length) {\n                const topOverlay = this.overlays[this.overlays.length - 1];\n                topOverlay.feature();\n                if (\n                    topOverlay.interaction === 'modal' ||\n                    topOverlay.hasModalRoot\n                ) {\n                    topOverlay.focus();\n                } else {\n                    this.stopTabTrapping();\n                }\n            } else {\n                this.stopTabTrapping();\n                if (\n                    overlay.interaction === 'modal' ||\n                    ((overlay.interaction === 'replace' ||\n                        overlay.interaction === 'inline') &&\n                        !overlay.tabbingAway)\n                ) {\n                    const overlayRoot = overlay.overlayContent.getRootNode() as ShadowRoot;\n                    const overlayContentActiveElement =\n                        overlayRoot.activeElement;\n                    const triggerRoot = overlay.trigger.getRootNode() as ShadowRoot;\n                    const triggerActiveElement = triggerRoot.activeElement;\n                    if (\n                        overlay.overlayContent.contains(\n                            overlayContentActiveElement\n                        ) ||\n                        overlay.trigger\n                            .getRootNode()\n                            .contains(triggerActiveElement) ||\n                        (triggerRoot.host &&\n                            triggerRoot.host === triggerActiveElement)\n                    ) {\n                        overlay.trigger.focus();\n                    }\n                }\n                overlay.tabbingAway = false;\n            }\n\n            overlay.remove();\n            overlay.dispose();\n\n            overlay.trigger.dispatchEvent(\n                new CustomEvent<OverlayOpenCloseDetail>('sp-closed', {\n                    bubbles: true,\n                    composed: true,\n                    cancelable: true,\n                    detail: {\n                        interaction: overlay.interaction,\n                    },\n                })\n            );\n        }\n    }\n\n    private closeTopOverlay(): Promise<void> {\n        return this.hideAndCloseOverlay(this.topOverlay);\n    }\n\n    /**\n     * A \"longpress\" occurs before the \"click\" that creates it has occured.\n     * In that way the first click will still be part of the \"longpress\" and\n     * not part of closing the overlay.\n     */\n    private _doesNotCloseOnFirstClick = false;\n\n    private handleMouse = (event: Event): void => {\n        if (this._doesNotCloseOnFirstClick) {\n            this._doesNotCloseOnFirstClick = false;\n            return;\n        }\n        if (this.preventMouseRootClose || event.defaultPrevented) {\n            return;\n        }\n        this.closeTopOverlay();\n    };\n\n    private handleKeyUp = (event: KeyboardEvent): void => {\n        if (event.code === 'Escape') {\n            const overlay = this.topOverlay as ActiveOverlay;\n            this.closeTopOverlay();\n            overlay && overlay.trigger.focus();\n        }\n    };\n\n    private handleResize = (): void => {\n        if (this.handlingResize) return;\n\n        this.handlingResize = true;\n        requestAnimationFrame(async () => {\n            const promises = this.overlays.map((overlay) =>\n                overlay.updateOverlayPosition()\n            );\n            await Promise.all(promises);\n            this.handlingResize = false;\n        });\n    };\n}\n"]}